using UnityEngine;
using System.Collections;
using UnityEngine.SceneManagement;
using UnityEngine.UI;

public class LoadingManager : MonoBehaviour
{
    private static LoadingManager _instance;
    public static LoadingManager Instance
    {
        get
        {
            if (_instance == null)
            {
                // Try to find it in the scene if it exists but hasn't set the instance
                _instance = FindFirstObjectByType<LoadingManager>();

                // If it's still null, we are likely testing and forgot to add it
                if (_instance == null)
                {
                    GameObject go = new GameObject("LoadingManager_AutoGenerated");
                    _instance = go.AddComponent<LoadingManager>();
                    Debug.Log("LoadingManager was missing, so I created one!");
                }
            }
            return _instance;
        }
    }

    private Slider progressBar;

    private void Awake()
    {
        if (_instance == null)
        {
            _instance = this;
            DontDestroyOnLoad(gameObject);
        }
        else if (_instance != this)
        {
            Destroy(gameObject);
        }
    }

    public IEnumerator LoadScene()
    {
        AsyncOperation op = SceneManager.LoadSceneAsync("LoadingScene", LoadSceneMode.Additive);
        
        while (!op.isDone)
        {
            yield return null;
        }


        progressBar = FindFirstObjectByType<Slider>();
    }

    public void UnloadLoadingScreen()
    {
        if (SceneManager.GetSceneByName("LoadingScene").isLoaded)
        {
            SceneManager.UnloadSceneAsync("LoadingScene");
            PickaxeShop.IsAnyShopOpen = false;
        }
    }

    public void UpdateProgress(float progress)
    {
        if (progressBar != null) progressBar.value = progress;
    }
}